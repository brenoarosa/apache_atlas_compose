--- apache-atlas-2.1.0_ec2/bin/atlas_start.py	2021-06-09 12:24:27.000000000 -0300
+++ atlas_start.py	2021-06-10 11:22:09.000000000 -0300
@@ -18,6 +18,9 @@
 import os
 import sys
 import traceback
+import os.path
+import time
+from time import sleep
 
 import atlas_config as mc
 
@@ -77,9 +80,10 @@
     atlas_classpath = confdir + p \
                        + os.path.join(web_app_dir, "atlas", "WEB-INF", "classes" ) + p \
                        + os.path.join(web_app_dir, "atlas", "WEB-INF", "lib", "*" )  + p \
-                       + os.path.join(atlas_home, "libext", "*") + p \
-                       + os.path.join(atlas_home, "libext", "janusgraph-es-0.5.1.jar") + p \
-                       + os.path.join(atlas_home, "/opt/hbase/lib/", "*")
+                       + os.path.join(atlas_home, "libext", "*")
+                       #+ p \
+                       #+ os.path.join(atlas_home, "libext", "janusgraph-es-0.5.1.jar") + p \
+                       #+ os.path.join(atlas_home, "/opt/hbase/lib/", "*")
 
     is_hbase = mc.is_hbase(confdir)
 
@@ -117,6 +121,9 @@
         mc.configure_hbase(atlas_home)
         mc.run_hbase_action(mc.hbaseBinDir(atlas_home), "start", hbase_conf_dir, logdir)
         print "hbase started."
+        if is_setup:
+            print("Sleeping 60s due too setup (init run)...")
+            sleep(60)
 
     #solr setup
     if mc.is_solr_local(confdir):
@@ -131,6 +138,9 @@
 
         mc.run_solr(mc.solrBinDir(atlas_home), "start", mc.get_solr_zk_url(confdir), mc.solrPort(), logdir)
         print "solr started."
+        if is_setup:
+            print("Sleeping 60s due too setup (init run)...")
+            sleep(60)
 
         print "setting up solr collections..."
         mc.create_solr_collection(mc.solrBinDir(atlas_home), mc.solrConfDir(atlas_home), "vertex_index", logdir)
@@ -148,8 +158,26 @@
         web_app_path = mc.convertCygwinPath(web_app_path)
     if not is_setup:
         start_atlas_server(atlas_classpath, atlas_pid_file, jvm_logdir, jvm_opts_list, web_app_path)
-        mc.wait_for_startup(confdir, 300)
-        print "Apache Atlas Server started!!!\n"
+        mc.wait_for_startup(confdir, 600)
+        print("Apache Atlas Server process started!!!\n")
+
+        atlas_pid_file = mc.pidFile(atlas_home)
+        try:
+            pf = file(atlas_pid_file, 'r')
+            pid = int(pf.read().strip())
+            pf.close()
+            print("Running Apache Atlas with PID " + str(pid) + "...\n")
+        except:
+            pid = None
+        if not pid:
+            sys.stderr.write("No PID file found! Server is not running?\nCheck logs: /opt/apache-atlas-2.1.0/logs/application.log\n\n")
+            return
+
+        while os.path.exists(atlas_pid_file):
+            sleep(1)
+
+        print("Apache Atlas stopped!\n")
+
     else:
         process = mc.java("org.apache.atlas.web.setup.AtlasSetup", [], atlas_classpath, jvm_opts_list, jvm_logdir)
         return process.wait()
